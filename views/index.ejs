<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watermarker - Bulk Image & Video Watermarking</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dropzone {
      border: 2px dashed #cbd5e0;
      transition: all 0.3s;
    }
    .dropzone.dragover {
      border-color: #4299e1;
      background-color: #ebf8ff;
    }
    .progress-bar {
      transition: width 0.3s ease;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-5xl font-bold text-indigo-900 mb-2">üåä Watermarker</h1>
      <p class="text-gray-600 text-lg">Bulk watermark your images and videos with ease</p>
    </div>

    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-2xl p-8">
      <form id="uploadForm" enctype="multipart/form-data">
        
        <!-- Watermark Upload Section -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">1. Upload Your Watermark</h2>
          <div class="dropzone rounded-lg p-6 text-center cursor-pointer" id="watermarkDropzone">
            <input type="file" id="watermarkInput" name="watermark" accept="image/*" class="hidden" required>
            <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <p class="text-gray-600 mb-1">Click to upload or drag and drop</p>
            <p class="text-sm text-gray-500">PNG, JPG, or GIF (recommended: transparent PNG)</p>
          </div>
          <div id="watermarkPreview" class="mt-4 hidden">
            <p class="text-sm text-green-600 font-medium">‚úì Watermark uploaded</p>
          </div>
        </div>

        <!-- Files Upload Section -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">2. Upload Files to Watermark</h2>
          <div class="dropzone rounded-lg p-6 text-center cursor-pointer" id="filesDropzone">
            <input type="file" id="filesInput" name="files" accept="image/*,video/*" multiple class="hidden" required>
            <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M8 14v20c0 4.418 7.163 8 16 8 1.381 0 2.721-.087 4-.252M8 14c0 4.418 7.163 8 16 8s16-3.582 16-8M8 14c0-4.418 7.163-8 16-8s16 3.582 16 8m0 0v14m0-4c0 4.418-7.163 8-16 8S8 28.418 8 24m32 10v6m0 0v6m0-6h6m-6 0h-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <p class="text-gray-600 mb-1">Click to upload or drag and drop</p>
            <p class="text-sm text-gray-500">Multiple images (JPG, PNG) or videos (MP4, MOV, AVI)</p>
          </div>
          <div id="filesPreview" class="mt-4 hidden">
            <p class="text-sm text-gray-600"><span id="fileCount">0</span> file(s) selected</p>
          </div>
        </div>

        <!-- Options Section -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">3. Watermark Options</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Position -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
              <select name="position" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                <option value="top-left">Top Left</option>
                <option value="top-center">Top Center</option>
                <option value="top-right">Top Right</option>
                <option value="center">Center</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="bottom-center">Bottom Center</option>
                <option value="bottom-right" selected>Bottom Right</option>
              </select>
            </div>

            <!-- Opacity -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Opacity: <span id="opacityValue">70%</span>
              </label>
              <input type="range" name="opacity" min="0" max="1" step="0.1" value="0.7" 
                     class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                     oninput="document.getElementById('opacityValue').textContent = Math.round(this.value * 100) + '%'">
            </div>

            <!-- Scale -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Size: <span id="scaleValue">20%</span>
              </label>
              <input type="range" name="scale" min="0.05" max="0.5" step="0.05" value="0.2" 
                     class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                     oninput="document.getElementById('scaleValue').textContent = Math.round(this.value * 100) + '%'">
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
          <button type="submit" id="submitBtn" 
                  class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform transition hover:scale-105">
            Apply Watermark
          </button>
        </div>
      </form>

      <!-- Progress Section -->
      <div id="progressSection" class="mt-8 hidden">
        <div class="bg-gray-100 rounded-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-3">Processing...</h3>
          <div class="w-full bg-gray-300 rounded-full h-4 mb-2">
            <div id="progressBar" class="progress-bar bg-indigo-600 h-4 rounded-full" style="width: 0%"></div>
          </div>
          <p class="text-sm text-gray-600 text-center">
            <span id="progressText">Starting...</span>
          </p>
        </div>
      </div>

      <!-- Download Section -->
      <div id="downloadSection" class="mt-8 hidden">
        <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 text-center">
          <svg class="mx-auto h-16 w-16 text-green-500 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3 class="text-2xl font-bold text-green-800 mb-2">Download Complete!</h3>
          <p class="text-gray-600 mb-4">Your watermarked files have been downloaded</p>
          <button id="resetBtn" 
                  class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform transition hover:scale-105">
            Process More Files
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-gray-600">
      <p class="text-sm">Made with ‚ù§Ô∏è using Electron + Node.js + Tailwind CSS</p>
    </div>
  </div>

  <script>
    // Watermark dropzone
    const watermarkDropzone = document.getElementById('watermarkDropzone');
    const watermarkInput = document.getElementById('watermarkInput');
    const watermarkPreview = document.getElementById('watermarkPreview');

    watermarkDropzone.addEventListener('click', () => watermarkInput.click());
    watermarkDropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      watermarkDropzone.classList.add('dragover');
    });
    watermarkDropzone.addEventListener('dragleave', () => {
      watermarkDropzone.classList.remove('dragover');
    });
    watermarkDropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      watermarkDropzone.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        watermarkInput.files = e.dataTransfer.files;
        watermarkPreview.classList.remove('hidden');
      }
    });
    watermarkInput.addEventListener('change', () => {
      if (watermarkInput.files.length > 0) {
        watermarkPreview.classList.remove('hidden');
      }
    });

    // Files dropzone
    const filesDropzone = document.getElementById('filesDropzone');
    const filesInput = document.getElementById('filesInput');
    const filesPreview = document.getElementById('filesPreview');
    const fileCount = document.getElementById('fileCount');

    filesDropzone.addEventListener('click', () => filesInput.click());
    filesDropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      filesDropzone.classList.add('dragover');
    });
    filesDropzone.addEventListener('dragleave', () => {
      filesDropzone.classList.remove('dragover');
    });
    filesDropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      filesDropzone.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        filesInput.files = e.dataTransfer.files;
        fileCount.textContent = e.dataTransfer.files.length;
        filesPreview.classList.remove('hidden');
      }
    });
    filesInput.addEventListener('change', () => {
      if (filesInput.files.length > 0) {
        fileCount.textContent = filesInput.files.length;
        filesPreview.classList.remove('hidden');
      }
    });

    // Form submission
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const submitBtn = document.getElementById('submitBtn');
      const progressSection = document.getElementById('progressSection');
      const downloadSection = document.getElementById('downloadSection');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Processing...';
      progressSection.classList.remove('hidden');
      downloadSection.classList.add('hidden');
      
      document.getElementById('progressText').textContent = 'Processing files, please wait...';
      document.getElementById('progressBar').style.width = '50%';
      
      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Upload failed');
        }
        
        // Get the ZIP file as blob
        const blob = await response.blob();
        
        // Create download link
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'watermarked-files.zip';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        // Show success
        progressSection.classList.add('hidden');
        downloadSection.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Apply Watermark';
      } catch (error) {
        alert('Error: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Apply Watermark';
        progressSection.classList.add('hidden');
      }
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      location.reload();
    });
  </script>
</body>
</html>
